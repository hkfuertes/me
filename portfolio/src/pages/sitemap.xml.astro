---
import { getCollection } from 'astro:content';
import { SEO_CONFIG } from '@/data/seo';
import { generateSlug, extractSlugFromGithubId } from '@/utils/slugify';

const gists = await getCollection('gists');
const githubRepos = await getCollection('githubRepos');

const allPosts = [...gists, ...githubRepos];

// P치ginas est치ticas
const staticPages = [
  { url: '', changefreq: 'weekly', priority: 1.0 },
  { url: 'blog', changefreq: 'daily', priority: 0.9 },
];

// P치ginas din치micas (posts) - usar slugs SEO-friendly
const dynamicPages = allPosts.map(post => {
  const isGitHub = post.id.includes('-');
  const slug = isGitHub 
    ? extractSlugFromGithubId(post.id.replace('github-hkfuertes-', ''))
    : generateSlug(post.data.title, post.data.date);
  
  return {
    url: `blog/${slug}`,
    lastmod: (post.data.updated || post.data.date).toISOString(),
    changefreq: 'monthly',
    priority: 0.7,
  };
});

const pages = [...staticPages, ...dynamicPages];
---
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  {pages.map(({ url, lastmod, changefreq, priority }) => (
    <url>
      <loc>{`${SEO_CONFIG.siteUrl}/${url}`}</loc>
      {lastmod && <lastmod>{lastmod}</lastmod>}
      <changefreq>{changefreq}</changefreq>
      <priority>{priority}</priority>
    </url>
  ))}
</urlset>
