services:
  x-common: &common
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - cv-data:/work
      - ./portfolio:/app
      - ./blog:/blog
      - ./Miguel_Fuertes_CV.yaml:/Miguel_Fuertes_CV.yaml:ro

  rendercv:
    <<: *common
    working_dir: /work
    entrypoint: ["rendercv"]

  build:
    <<: *common
    command: /bin/bash -c "npm i && npm run build"
    environment:
      - GITHUB_TOKEN=${GITHUB_TOKEN}

  app:
    <<: *common
    command: /bin/bash -c "npm i && npm run dev"
    ports:
      - "4321:4321"
    environment:
      - HOST=0.0.0.0
      - PORT=4321
      - GITHUB_TOKEN=${GITHUB_TOKEN}

  mcp:
    build:
      context: ./mcp
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    volumes:
      - ./mcp:/app
      - ./mcp/data.yaml:/app/data.yaml:ro
    environment:
      - HOST=0.0.0.0
      - PORT=8000

volumes:
  cv-data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${PWD}
